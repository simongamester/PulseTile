<!--
  ~  Copyright 2017 Ripple Foundation C.I.C. Ltd
  ~  
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~  
  ~    http://www.apache.org/licenses/LICENSE-2.0

  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
-->
<div mc-full-panel mc-datepicker mc-accordion mc-open-panel="medication" class="panel-group accordion">
  <div class="panel panel-secondary" ng-if="getShowPanel('medication') && !isMedicationEdit" ng-class="getOpenPanelClass('medication');">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'medication')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('medication')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Medication</h3>
    </div>
    <div class="panel-body">
      <div class="panel-body-inner">
        <div class="form">
          <div class="form-group-wrapper">
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Name</label>
                  <div class="form-control-static">{{ $ctrl.medication.name }}</div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Dose Amount</label>
                  <div class="form-control-static">{{ $ctrl.medication.doseAmount }}</div>
                </div>
              </div>
            </div>
            
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Dose Timing</label>
                  <div class="form-control-static">{{ $ctrl.medication.doseTiming }}</div>
                </div>

                <div class="form-group">
                  <div class="wrap-control-group">
                    <div class="control-group left">
                      <button type="button" class="btn btn-primary btn-inverse" ng-click="openPanel('prescription')"><span class="btn-text">Prescription</span></button>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label class="control-label">Dose Directions</label>
                  <div class="form-control-static">{{ $ctrl.medication.doseDirections }}</div>
                </div>
              </div>
            </div>
            
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Author</label>
                  <div class="form-control-static">{{ $ctrl.medication.author }}</div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Date</label>
                  <div class="form-control-static">{{ $ctrl.medication.startDate | date:'dd-MMM-yyyy' }}</div>
                </div>
              </div>
            </div>

            <div class="row-expand" ng-if="$ctrl.medication.originalSource.length">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Original Source</label>
                  <div class="form-control-static">{{ $ctrl.medication.originalSource }}</div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Is Imported</label>
                  <div class="input-holder">
                    <label class="switch">
                      <input type="checkbox" name="isImported" ng-model="true" disabled>
                      <div class="slider disabled">
                        <span class="text text-check-true">Yes</span>
                        <span class="text text-check-false">No</span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            

            <!-- <div class="form-group">
              <label class="control-label">Time</label>
              <div class="form-control-static">{{ $ctrl.medication.startTime | date:'hh:mm a' }}</div>
            </div> -->

            <!-- <div class="form-group">
              <label class="control-label">Route</label>
              <div class="form-control-static">{{ $ctrl.medication.route }}</div>
            </div>

            <div class="form-group">
              <label class="control-label">Terminology</label>
              <div class="form-control-static">{{ $ctrl.medication.medicationTerminology }}</div>
            </div>

            <div class="form-group">
              <label class="control-label">Source</label>
              <div class="form-control-static">{{ $ctrl.medication.source }}</div>
            </div> -->
          </div>
        </div>
        
      </div>
      <div class="panel-control" ng-if="$ctrl.currentUser.permissions.indexOf('WRITE') !== -1">
        <div class="wrap-control-group hide-indent-bottom">
          <div class="control-group with-indent left hidden-xs">
            <button class="btn btn-danger"><i class="btn-icon fa fa-close"></i> <span class="btn-text">Cancel</span></button>
            <button class="btn btn-success btn-pause"><i class="btn-icon fa fa-pause"></i> <span class="btn-text">Suspend</span></button>
            <button class="btn btn-success"><i class="btn-icon fa fa-share"></i> <span class="btn-text">Order</span></button>
          </div>
          <div class="control-group with-indent right">
            <button class="btn btn-success btn-inverse btn-edit" ng-click="$ctrl.editMedication();"><i class="btn-icon fa fa-edit"></i> <span class="btn-text">Edit</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="panel panel-secondary" ng-if="getShowPanel('medication') && isMedicationEdit" ng-class="getOpenPanelClass('medication')">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'medication')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('medication')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Edit Medication</h3>
    </div>
    <div class="panel-body">
      <div class="panel-body-inner">
        <form name="medicationForm" class="form">
          <div class="form-group-wrapper">
            
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || medicationForm.name.$dirty) && medicationForm.name.$invalid, 'has-success': medicationForm.name.$valid && medicationForm.name.$dirty}">
                    <label for="name" class="control-label">Name</label>
                    <div class="input-holder">
                        <input type="text" class="form-control input-sm" id="name" name="name" ng-model="medicationEdit.name" required>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.name.$error.required">You must enter a value.</span>
                </div>
              </div>
              
              <div class="col-expand-right">
                <div class="row">
                  <div class="col-xs-12 col-md-6">
                    <div class="form-group" ng-class="{'has-error': (formSubmitted || medicationForm.doseAmount.$dirty) && medicationForm.doseAmount.$invalid, 'has-success': medicationForm.doseAmount.$valid && medicationForm.doseAmount.$dirty}">
                        <label for="doseAmount" class="control-label">Dose Amount</label>
                        <div class="input-holder">
                            <input type="text" class="form-control input-sm" id="doseAmount" name="doseAmount" ng-model="medicationEdit.doseAmount" required />
                        </div>
                        <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.doseAmount.$error.required">You must enter a value.</span>
                    </div>
                  </div>
                  <div class="col-xs-12 col-md-6">
                    <div class="form-group">
                      <label class="control-label"></label>
                      <div class="input-holder">
                        <div class="wrap-fcustominp">
                          <div class="fcustominp">
                            <input type="checkbox" id="doseAmountVariable" name="doseAmountVariable" ng-model="medicationForm.doseAmountVariable" />
                            <label for="doseAmountVariable"></label>
                          </div>
                          <label for="doseAmountVariable" class="fcustominp-label">Variable</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Dose Timing</label>
                  <div class="form-control-static">{{ medicationEdit.doseTiming }}</div>
                </div>

                <div class="form-group">
                  <div class="wrap-control-group">
                    <div class="control-group left">
                      <button type="button" class="btn btn-primary btn-inverse" ng-click="openPanel('prescription')"><span class="btn-text">Prescription</span></button>
                    </div>
                  </div>
                </div>
                
                <div class="form-group" ng-class="{'has-error': (formSubmitted || medicationForm.doseDirections.$dirty) && medicationForm.doseDirections.$invalid, 'has-success': medicationForm.doseDirections.$valid && medicationForm.doseDirections.$dirty}">
                    <label for="doseDirections" class="control-label">Dose Directions</label>
                    <div class="input-holder">
                        <textarea type="text" class="form-control textarea-big input-sm" id="doseDirections" name="doseDirections" ng-model="medicationEdit.doseDirections" required></textarea>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.doseDirections.$error.required">You must enter a value.</span>
                </div>
              </div>
            </div>

            <div class="form-group form-group-sm" ng-if="medicationEdit.isImport">
              <label for="originalSource" class="control-label">Import URL</label>
              <div class="input-holder">
                <input type="text" class="form-control input-sm" id="originalSource" name="originalSource" ng-model="medicationEdit.originalSource" disabled />
              </div>
            </div>

            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group form-group-sm" ng-class="{'has-error': (formSubmitted || medicationForm.author.$dirty) && medicationForm.author.$invalid, 'has-success': medicationForm.author.$valid && medicationForm.author.$dirty}">
                    <label for="author" class="control-label">Author</label>
                    <div class="input-holder">
                        <input type="text" value="{{currentUser.email}}" placeholder="{{currentUser.email}}" class="form-control input-sm" id="author" name="author" ng-model="medicationEdit.author" disabled />
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.author.$error.required">You must enter a value.</span>
                </div>
              </div>
              <div class="col-expand-right">
                  <div class="form-group form-group-sm" ng-class="{'has-error': (formSubmitted || medicationForm.startDateTime.$dirty) && medicationForm.startDateTime.$invalid, 'has-success': medicationForm.startDateTime.$valid && medicationForm.startDateTime.$dirty}">
                      <label for="" class="control-label">Date</label>
                      <div class="inner-addon addon-left">
                        <div class="addon">
                          <i class="fa fa-calendar"></i>
                        </div>
                        <input type="text" class="form-control" id="startDateTime" name="startDateTime" ng-model="medicationEdit.startDate" ng-click="openDatepicker($event, 'startDateTime')" uib-datepicker-popup="dd-MMM-yyyy" is-open="datepickers.startDateTime" required disabled/>
                      </div>
                      <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.startDateTime.$error.required">You must enter a valid date.</span>
                  </div>
              </div>
            </div>
            
            <!-- <div class="form-group form-group-sm" ng-class="{'has-error': (formSubmitted || medicationForm.time.$dirty) && medicationForm.time.$invalid, 'has-success': medicationForm.time.$valid && medicationForm.time.$dirty}">
                <label for="time" class="control-label">Time</label>
                <div class="inner-addon addon-left">
                  <div class="addon">
                    <i class="fa fa-clock-o"></i>
                  </div>
                  <input class="form-control" id="time" name="time" ui-timepicker ng-model="medicationEdit.startTime" required/>
                </div>
            </div> -->


            <!-- <div class="form-group" ng-class="{'has-error': (formSubmitted || medicationForm.terminology.$dirty) && medicationForm.terminology.$invalid, 'has-success': medicationForm.terminology.$valid && medicationForm.terminology.$dirty}">
                <label for="terminology" class="control-label">Terminology</label>
                <div class="input-holder">
                    <input type="text" class="form-control input-sm" id="terminology" name="terminology" ng-model="medicationEdit.medicationTerminology" required />
                </div>
                <span class="help-block animate-fade" ng-show="formSubmitted && medicationForm.terminology.$error.required">You must enter a value.</span>
            </div> -->

          </div>
        </form>
        
      </div>
      <div class="panel-control" ng-if="$ctrl.currentUser.permissions.indexOf('WRITE') !== -1">
        <div class="wrap-control-group">
          <div class="control-group right">
            <button class="btn btn-danger" ng-click="$ctrl.cancelEditMedication()"><i class="btn-icon fa fa-ban"></i> <span class="btn-text">Cancel</span></button>
            <button class="btn btn-success" ng-click="confirmEditMedication(medicationForm, medicationEdit)"><i class="btn-icon fa fa-check"></i> <span class="btn-text">Complete</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="panel panel-secondary" ng-if="getShowPanel('prescription') && !isPrescriptionEdit" ng-class="getOpenPanelClass('prescription')">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'prescription')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('prescription')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Prescription (1)</h3>
    </div>
    <div class="panel-body">
      <div class="panel-body-inner">
        <div class="form">
          <div class="panel-body-section">
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Name</label>
                  <div class="form-control-static">{{ $ctrl.medication.name }}</div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Dose Amount</label>
                  <div class="form-control-static">{{ $ctrl.medication.doseAmount }}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel-body-section">
            <div class="form-group">
              <label class="control-label">Dose Timing:</label>
              <div class="form-control-static">2X each morning {{ $ctrl.medication.timing }}</div>
            </div>

            <div class="form-group">
              <div class="wrap-control-group">
                <div class="control-group left">
                  <button type="button" class="btn btn-success btn-sm btn-inverse btn-icon-normal btn-dropdown-toggle btn-schedule" ng-click="toggleShowSchedule()"><i class="btn-icon fa fa-table"></i> <span class="btn-text">Hourly Schedule</span></button>
                </div>
              </div>
              <div ng-if="isShowSchedule" class="schedule-block">
                <div class="panel panel-small panel-table">
                  <div class="panel-heading">
                    <h3 class="panel-title">27-Nov-2016</h3>
                  </div>
                  <div class="panel-body">
                    <div class="wrap-table-scrollX">
                      <table class="table table-striped table-bordered table-fixedcol table-schedule">
                        <thead>
                          <tr>
                              <th>09:00</th>
                              <th>10:00</th>
                              <th class="selected">11:00</th>
                              <th>12:00</th>
                              <th>13:00</th>
                              <th>14:00</th>
                              <th>15:00</th>
                              <th class="selected">16:00</th>
                              <th>17:00</th>
                              <th>18:00</th>
                              <th>19:00</th>
                              <th>20:00</th>
                              <th class="selected">21:00</th>
                              <th>22:00</th>
                              <th>23:00</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="panel-control" ng-if="$ctrl.currentUser.permissions.indexOf('WRITE') !== -1">
        <div class="wrap-control-group hide-indent-bottom">
          <div class="control-group with-indent right">
            <button class="btn btn-success btn-inverse" ng-click="$ctrl.editPrescription();"><i class="btn-icon fa fa-edit"></i> <span class="btn-text">Edit</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="panel panel-secondary" ng-if="getShowPanel('prescription') && isPrescriptionEdit" ng-class="getOpenPanelClass('prescription')">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'prescription')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('prescription')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Edit Prescription (1)</h3>
    </div>
    <div class="panel-body">
      <div class="panel-body-inner">
        <form name="prescriptionForm" class="form">
          <div class="panel-body-section">
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Name</label>
                  <div class="form-control-static">{{ $ctrl.medication.name }}</div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Dose Amount</label>
                  <div class="form-control-static">{{ $ctrl.medication.doseAmount }}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="row-expand">
            <div class="col-expand-left"></div>
            <div class="col-expand-right"></div>
          </div>
          <div class="panel-body-section">
            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group">
                  <label class="control-label">Dose Interval</label>
                  <div class="input-holder">
                    <div class="wrap-fcustominps-inline">
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseIntervalMorning" name="doseInterval" value="morning" ng-model="prescriptionEdit.doseInterval"/>
                          <label for="doseIntervalMorning"></label>
                        </div>
                        <label for="doseIntervalMorning" class="fcustominp-label">Morning</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseIntervalEvening" name="doseInterval" value="evening" ng-model="prescriptionEdit.doseInterval"/>
                          <label for="doseIntervalEvening"></label>
                        </div>
                        <label for="doseIntervalEvening" class="fcustominp-label">Evening</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseIntervalSpecific" name="doseInterval" value="specific" ng-model="prescriptionEdit.doseInterval"/>
                          <label for="doseIntervalSpecific"></label>
                        </div>
                        <label for="doseIntervalSpecific" class="fcustominp-label">Specific</label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-expand-right">
                <div class="form-group">
                  <label class="control-label">Dose Quantity</label>
                  <div class="input-holder">
                    <div class="wrap-fcustominps-inline">
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseQuantity1x" name="doseQuantity" value="1x" ng-model="prescriptionEdit.doseQuantity"/>
                          <label for="doseQuantity1x"></label>
                        </div>
                        <label for="doseQuantity1x" class="fcustominp-label">1X</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseQuantity2x" name="doseQuantity" value="2x" ng-model="prescriptionEdit.doseQuantity"/>
                          <label for="doseQuantity2x"></label>
                        </div>
                        <label for="doseQuantity2x" class="fcustominp-label">2X</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseQuantity3x" name="doseQuantity" value="3x" ng-model="prescriptionEdit.doseQuantity"/>
                          <label for="doseQuantity3x"></label>
                        </div>
                        <label for="doseQuantity3x" class="fcustominp-label">3X</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseQuantity4x" name="doseQuantity" value="4x" ng-model="prescriptionEdit.doseQuantity"/>
                          <label for="doseQuantity4x"></label>
                        </div>
                        <label for="doseQuantity4x" class="fcustominp-label">4X</label>
                      </div>
                      <div class="wrap-fcustominp">
                        <div class="fcustominp">
                          <input type="radio" id="doseQuantityOther" name="doseQuantity" value="other" ng-model="prescriptionEdit.doseQuantity"/>
                          <label for="doseQuantityOther"></label>
                        </div>
                        <label for="doseQuantityOther" class="fcustominp-label">Other</label>
                      </div>
                     
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row-expand">
              <div class="col-expand-left">
                <div class="form-group" ng-class="{'has-error': (formSubmitted || prescriptionForm.route.$dirty) && prescriptionForm.route.$invalid, 'has-success': prescriptionForm.route.$valid && prescriptionForm.route.$dirty}">
                    <label for="route" class="control-label">Route</label>
                    <div class="input-holder">
                        <select class="form-control input-sm" id="route" name="route" ng-model="prescriptionEdit.route" required>
                            <option value="">-- Route --</option>
                            <option>Po Per Oral</option>
                            <option>IV Intra Venous</option>
                            <option>IM Intra Muscular</option>
                            <option>PN Per Nasal</option>
                            <option>PR Per Rectum</option>
                            <option>SL Sub Lingual</option>
                            <option>SC Sub Cutaneous</option>
                        </select>
                    </div>
                    <span class="help-block animate-fade" ng-show="formSubmitted && prescriptionForm.route.$error.required">You must enter a value.</span>
                </div>
              </div>
            </div>
            
            <div class="row-expand">
              <div class="col-expand-left">
                <div ng-if="prescriptionEdit.doseQuantity && prescriptionEdit.doseInterval">
                  <div class="row">
                    <div class="col-xs-12 col-md-6">
                      <div class="form-group form-group-sm" ng-class="{'has-error': (formSubmitted || prescriptionForm.pStartDateTime.$dirty) && prescriptionForm.pStartDateTime.$invalid, 'has-success': prescriptionForm.pStartDateTime.$valid && prescriptionForm.pStartDateTime.$dirty}">
                          <label for="" class="control-label">Start</label>
                          <div class="inner-addon addon-left">
                            <div class="addon">
                              <i class="fa fa-calendar"></i>
                            </div>
                            <input type="text" class="form-control" id="pStartDateTime" name="pStartDateTime" ng-model="prescriptionEdit.pStartDateTime" ng-click="openDatepicker($event, 'pStartDateTime')" uib-datepicker-popup="dd-MMM-yyyy" is-open="datepickers.pStartDateTime" required readonly/>
                          </div>
                          <span class="help-block animate-fade" ng-show="formSubmitted && prescriptionForm.pStartDateTime.$error.required">You must enter a valid date.</span>
                      </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                      <div class="form-group">
                        <label class="control-label hidden-sm"></label>
                        <div class="input-holder">
                          <div class="wrap-fcustominp">
                            <div class="fcustominp">
                              <input type="checkbox" id="finishCancelled" name="finishCancelled" ng-model="prescriptionEdit.finishCancelled"/>
                              <label for="finishCancelled"></label>
                            </div>
                            <label for="finishCancelled" class="fcustominp-label">Until Cancelled</label>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xs-12 col-md-6">
                      <div class="form-group form-group-sm" ng-if="!prescriptionEdit.finishCancelled" ng-class="{'has-error': (formSubmitted || prescriptionForm.pFinishDateTime.$dirty) && prescriptionForm.pFinishDateTime.$invalid, 'has-success': prescriptionForm.pFinishDateTime.$valid && prescriptionForm.pFinishDateTime.$dirty}">
                          <label for="" class="control-label">Finish</label>
                          <div class="inner-addon addon-left">
                            <div class="addon">
                              <i class="fa fa-calendar"></i>
                            </div>
                            <input type="text" class="form-control" id="pFinishDateTime" name="pFinishDateTime" ng-model="prescriptionEdit.pFinishDateTime" ng-click="openDatepicker($event, 'pFinishDateTime')" uib-datepicker-popup="dd-MMM-yyyy" is-open="datepickers.pFinishDateTime" required readonly/>
                          </div>
                          <span class="help-block animate-fade" ng-show="formSubmitted && prescriptionForm.pFinishDateTime.$error.required">You must enter a valid date.</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div ng-if="prescriptionEdit.doseQuantity && prescriptionEdit.doseInterval && prescriptionEdit.route && prescriptionEdit.pStartDateTime && (prescriptionEdit.finishCancelled || prescriptionEdit.pFinishDateTime)" class="form-group">
              <div class="wrap-control-group">
                <div class="control-group left">
                  <button type="button" class="btn btn-success btn-icon-normal" ng-click="">
                    <i class="btn-icon fa fa-plus"></i>
                    <span class="btn-text">Add Dosage</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="panel-body-section">
            <div class="form-group">
              <label class="control-label">Dose Timing:</label>
              <div class="non-edit-value">
                <button type="button" class="btn btn-danger btn-sm btn-icon-normal btn-square" ng-click="">
                  <i class="btn-icon fa fa-ban"></i>
                </button>
                <span>2X each morning {{ $ctrl.medication.timing }}</span>
              </div>
            </div>
            <div class="form-group">
              <div class="wrap-control-group">
                <div class="control-group left">
                  <button type="button" class="btn btn-success btn-sm btn-inverse btn-icon-normal btn-dropdown-toggle btn-schedule" ng-click="toggleShowSchedule()"><i class="btn-icon fa fa-table"></i> <span class="btn-text">Hourly Schedule</span></button>
                </div>
              </div>
              <div ng-if="isShowSchedule" class="schedule-block">
                <div class="panel panel-small panel-table">
                  <div class="panel-heading">
                    <h3 class="panel-title">27-Nov-2016</h3>
                  </div>
                  <div class="panel-body">
                    <div class="wrap-table-scrollX">
                      <table class="table table-striped table-bordered table-fixedcol table-schedule">
                        <thead>
                          <tr>
                              <th>09:00</th>
                              <th>10:00</th>
                              <th class="selected">11:00</th>
                              <th>12:00</th>
                              <th>13:00</th>
                              <th>14:00</th>
                              <th>15:00</th>
                              <th class="selected">16:00</th>
                              <th>17:00</th>
                              <th>18:00</th>
                              <th>19:00</th>
                              <th>20:00</th>
                              <th class="selected">21:00</th>
                              <th>22:00</th>
                              <th>23:00</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td></td>
                              <td class="selected">2X</td>
                              <td></td>
                              <td></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="panel-control" ng-if="$ctrl.currentUser.permissions.indexOf('WRITE') !== -1">
        <div class="wrap-control-group">
          <div class="control-group right">
            <button class="btn btn-danger" ng-click="$ctrl.cancelEditPrescription()"><i class="btn-icon fa fa-ban"></i> <span class="btn-text">Cancel</span></button>
            <button class="btn btn-success" ng-click="confirmEditPrescription(medicationForm, medicationEdit)"><i class="btn-icon fa fa-check"></i> <span class="btn-text">Complete</span></button>
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="panel panel-secondary" ng-if="getShowPanel('warning')" ng-class="getOpenPanelClass('warning')">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'warning')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('warning')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Warnings (2)</h3>
    </div>
    <div class="panel-body">
      <div class="panel-expand-wrapper">
        <div class="panel-expand-row">
          <div class="panel-expand-item">
            <div class="panel-body-inner highlighter-wrapper">
              <span class="highlighter-warning" ng-if="true"></span>
              <span class="highlighter-danger" ng-if="false"></span>
              <div class="form">
                <div class="form-group">
                  <label class="control-label">Warning #1</label>
                  <div class="form-control-static">Interaction found between <a>Furosemide</a> and <a>Latanoprost</a></div>
                </div>

                <div class="form-group">
                  <label class="control-label">Effects</label>
                  <div class="form-control-static">Anticonvulsant effect antagonised</div>
                </div>
              </div>
            </div>
          </div>
          <div class="panel-expand-item">
            <div class="panel-body-inner highlighter-wrapper">
              <span class="highlighter-warning" ng-if="false"></span>
              <span class="highlighter-danger" ng-if="true"></span>
              <div class="form">
                <div class="form-group">
                  <label class="control-label">Warning #2</label>
                  <div class="form-control-static">Interaction found between <a>Furosemide</a> and <a>Digoxin</a></div>
                </div>

                <div class="form-group">
                  <label class="control-label">Effects</label>
                  <div class="form-control-static">May increase anticoagulant effect</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel panel-secondary" ng-if="getShowPanel('history')" ng-class="getOpenPanelClass('history')">
    <div class="panel-heading">
      <div class="control-group right">
        <button class="btn btn-success btn-inverse btn-square hidden-xs hidden-sm btn-expand-panel" ng-click="changeFullPanel('details', 'history')"><i class="btn-icon fa fa-expand"></i><i class="btn-icon fa fa-compress"></i></button>
        <button class="btn btn-success btn-inverse btn-square btn-toggle-rotate" ng-click="openPanel('history')"><i class="btn-icon fa fa-chevron-up"></i></button>
      </div>
      <h3 class="panel-title">Change History (1)</h3>
    </div>
    <div class="panel-body">
      <div class="panel-expand-wrapper">
        <div class="panel-expand-row">
          <div class="panel-expand-item">
            <div class="panel-body-inner">
              <div class="form">
                <div class="form-group">
                  <label class="control-label">Change #1 Date</label>
                  <div class="form-control-static">11-Oct-2016 11:45</div>
                </div>

                <div class="form-group">
                  <label class="control-label">Changes</label>
                  <div class="form-control-static">Dose: <em>60mg</em>  <span class="next-separate"><i class="fa fa-caret-right"></i></span>  40-20mg</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

	<span class="patientSummary-spinner" us-spinner="{radius:20, width:8, length: 16}" spinner-key="detail-spinner" spinner-start-active="true"></span>
	<span class="patientSummary-spinner" us-spinner="{radius:20, width:8, length: 16}" spinner-key="detail-update-spinner"></span>
</div>
